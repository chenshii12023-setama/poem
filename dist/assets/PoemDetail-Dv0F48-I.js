import{b as p,t as v,d as h}from"./poem-service-BC27KGA3.js";import{c as m,b as _,o as a,a as e,t as n,F as c,r as u,w as f,v as g}from"./index-KftFhpGg.js";import{_ as w}from"./_plugin-vue_export-helper-DlAUqK2U.js";const C={data(){return{poem:null,isFavorite:!1,newComment:""}},async created(){await this.fetchPoem()},methods:{async fetchPoem(){this.poem=await h(this.$route.params.id)},async toggleFavorite(){await v("current-user-id",this.poem.id),this.isFavorite=!this.isFavorite},async submitComment(){if(!this.newComment.trim())return;await p("current-user-id",this.poem.id,this.newComment),this.newComment="",await this.fetchPoem()},formatDate(i){return new Date(i).toLocaleString()}}},b={key:0,class:"poem-detail"},y={class:"poem-header"},F={class:"author"},k={class:"poem-content"},D={class:"poem-meta"},I={class:"annotations"},P={class:"comments"},x={class:"comment-form"},B={class:"comment-list"},V={class:"user"},L={class:"content"},N={class:"time"};function S(i,s,E,M,o,r){var l;return o.poem?(a(),m("div",b,[e("button",{class:"back-btn",onClick:s[0]||(s[0]=t=>i.$router.go(-1))},"返回"),e("div",y,[e("h1",null,n(o.poem.title),1),e("p",F,n((l=o.poem.authors)==null?void 0:l.name),1)]),e("div",k,[e("pre",null,n(o.poem.content),1)]),e("div",D,[e("span",null,n(o.poem.dynasty)+"·"+n(o.poem.genre),1),e("button",{class:"favorite-btn",onClick:s[1]||(s[1]=(...t)=>r.toggleFavorite&&r.toggleFavorite(...t))},n(o.isFavorite?"已收藏":"收藏"),1)]),e("div",I,[s[4]||(s[4]=e("h3",null,"注释",-1)),(a(!0),m(c,null,u(o.poem.annotations,t=>(a(),m("p",{key:t.id},n(t.content),1))),128))]),e("div",P,[s[5]||(s[5]=e("h3",null,"评论",-1)),e("div",x,[f(e("textarea",{"onUpdate:modelValue":s[2]||(s[2]=t=>o.newComment=t),placeholder:"写下你的评论..."},null,512),[[g,o.newComment]]),e("button",{onClick:s[3]||(s[3]=(...t)=>r.submitComment&&r.submitComment(...t))},"提交")]),e("div",B,[(a(!0),m(c,null,u(o.poem.comments,t=>{var d;return a(),m("div",{key:t.id,class:"comment"},[e("div",V,n(((d=t.users)==null?void 0:d.username)||"匿名用户"),1),e("div",L,n(t.content),1),e("div",N,n(r.formatDate(t.created_at)),1)])}),128))])])])):_("",!0)}const q=w(C,[["render",S],["__scopeId","data-v-4a93058d"]]);export{q as default};
