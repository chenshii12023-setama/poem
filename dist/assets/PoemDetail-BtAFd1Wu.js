import{_ as p,c as m,b as v,o as a,a as e,t as n,F as c,r as u,w as h,v as _}from"./index-DViaX2Tl.js";import"./poem-service-BuzQRXcw.js";const f={data(){return{poem:null,isFavorite:!1,newComment:""}},async created(){await this.fetchPoem()},methods:{async fetchPoem(){this.poem=await getPoemById(this.$route.params.id)},async toggleFavorite(){await toggleFavorite("current-user-id",this.poem.id),this.isFavorite=!this.isFavorite},async submitComment(){if(!this.newComment.trim())return;await addComment("current-user-id",this.poem.id,this.newComment),this.newComment="",await this.fetchPoem()},formatDate(i){return new Date(i).toLocaleString()}}},g={key:0,class:"poem-detail"},w={class:"poem-header"},C={class:"author"},y={class:"poem-content"},b={class:"poem-meta"},F={class:"annotations"},k={class:"comments"},D={class:"comment-form"},I={class:"comment-list"},P={class:"user"},x={class:"content"},B={class:"time"};function V(i,s,L,N,o,r){var l;return o.poem?(a(),m("div",g,[e("button",{class:"back-btn",onClick:s[0]||(s[0]=t=>i.$router.go(-1))},"返回"),e("div",w,[e("h1",null,n(o.poem.title),1),e("p",C,n((l=o.poem.authors)==null?void 0:l.name),1)]),e("div",y,[e("pre",null,n(o.poem.content),1)]),e("div",b,[e("span",null,n(o.poem.dynasty)+"·"+n(o.poem.genre),1),e("button",{class:"favorite-btn",onClick:s[1]||(s[1]=(...t)=>r.toggleFavorite&&r.toggleFavorite(...t))},n(o.isFavorite?"已收藏":"收藏"),1)]),e("div",F,[s[4]||(s[4]=e("h3",null,"注释",-1)),(a(!0),m(c,null,u(o.poem.annotations,t=>(a(),m("p",{key:t.id},n(t.content),1))),128))]),e("div",k,[s[5]||(s[5]=e("h3",null,"评论",-1)),e("div",D,[h(e("textarea",{"onUpdate:modelValue":s[2]||(s[2]=t=>o.newComment=t),placeholder:"写下你的评论..."},null,512),[[_,o.newComment]]),e("button",{onClick:s[3]||(s[3]=(...t)=>r.submitComment&&r.submitComment(...t))},"提交")]),e("div",I,[(a(!0),m(c,null,u(o.poem.comments,t=>{var d;return a(),m("div",{key:t.id,class:"comment"},[e("div",P,n(((d=t.users)==null?void 0:d.username)||"匿名用户"),1),e("div",x,n(t.content),1),e("div",B,n(r.formatDate(t.created_at)),1)])}),128))])])])):v("",!0)}const M=p(f,[["render",V],["__scopeId","data-v-12d02810"]]);export{M as default};
